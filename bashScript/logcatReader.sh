#!/bin/zsh

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ farmx
function finalize() {
    echo
    echo "Ð§Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ, Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ..."
    stty -icanon
    dd bs=1 count=1 >/dev/null 2>&1
    stty icanon
    farmx
}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
if [ "$#" -gt 2 ]; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÑƒÐ¶Ð½Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ 1 ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾"
    finalize
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
if [ "$#" -eq 0 ]; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð² Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¸Ð· ADB (ÑÐ¾Ð¾Ð±Ñ‰Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÑƒ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°)"
    finalize
    exit 1
fi

# Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð´ÐµÐ²Ð°Ð¹ÑÐ° Ð¸Ð· Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ
device=$2

# Ð¡Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð° (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð°Ð¿ÐºÑƒ)
echo "ðŸ“ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿ÑƒÑ‚ÑŒ Ðº Ð¿Ð°Ð¿ÐºÐµ Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð»Ð¾Ð³Ð¾Ð² Ñ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð° $device:"
echo "\033[3mÐ˜Ð»Ð¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Enterâ†µ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð² Ð¿Ð°Ð¿ÐºÑƒ ~/Downloads\033[0m"
read -r user_dir

# Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ, ÐµÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð²Ð²ÐµÐ»
if [[ -z "$user_dir" ]]; then
    user_dir=~/Downloads
    echo "ðŸ“‚Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽ Ð¿ÑƒÑ‚ÑŒ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ: $user_dir"
else
    echo "ðŸ“‚Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¹ Ð¿ÑƒÑ‚ÑŒ: $user_dir"
fi

# Ð Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ñ ~ Ð² Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ
user_dir=$(eval echo "$user_dir")

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ, ÐµÑÐ»Ð¸ Ð¾Ð½Ð° Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
mkdir -p "$user_dir"

# ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·ÑƒÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ð² Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ñ‹Ð¹
user_dir=$(realpath "$user_dir")

# Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ Ðº Ñ„Ð°Ð¹Ð»Ñƒ Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼ Ð¸Ð¼ÐµÐ½Ð¸ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
file_name="logs_$device.txt"
user_path="${user_dir%/}/$file_name" # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ð¹ ÑÐ»ÐµÑˆ Ð² ÐºÐ¾Ð½Ñ†Ðµ Ð¿ÑƒÑ‚Ð¸

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ adb logcat Ð¸ Ð·Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð»Ð¾Ð³Ð¸ Ð² Ñ„Ð°Ð¹Ð»
echo "â³ ÐžÑ‚Ñ‡Ð¸Ñ‰Ð°ÑŽ logcat Ð»Ð¾Ð³Ð¸ Ð½Ð° Ð´ÐµÐ²Ð°Ð¹ÑÐµ $device..."
adb -s "$device" logcat -c
echo "âœ… ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð»Ð¾Ð³Ð¾Ð² Ð² Ñ„Ð°Ð¹Ð» $user_path..."
echo "\033[1mÐ§Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ControlâŒƒ + C\033[0m"
adb -s "$device" logcat >"${user_path}"

finalize
exit 0
