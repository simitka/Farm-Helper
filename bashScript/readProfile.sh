#!/bin/zsh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞
if [ -z "$1" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–∫–∞–∑–∞–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ JSON —Ñ–∞–π–ª–∞"
  echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <–Ω–∞–∑–≤–∞–Ω–∏–µ_json_—Ñ–∞–π–ª–∞> [–∏–Ω—Ç–µ—Ä–≤–∞–ª_–≤_—Å–µ–∫—É–Ω–¥–∞—Ö]"
  exit 1
fi

# –ó–∞–¥–∞–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
json_file=$1
file_path="/sdcard/Android/data/farm.parking.game/files/profiles/$json_file"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∞ —Ñ–∞–π–ª–∞
read_file() {
  clear                                     # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º
  update_count=$((update_count + 1))        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  current_time=$(date "+%Y-%m-%d %H:%M:%S") # –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è

  # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–≤–µ—Ä—Ö—É
  if [ "$interval" -gt 0 ]; then
    echo "\033[1m–ß—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞–∂–º–∏—Ç–µ Control‚åÉ + C\033[0m"
    echo ""
    echo "–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: $interval —Å–µ–∫—É–Ω–¥"
    echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: $update_count"
    echo "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $current_time"
    echo "-------------------------------"
  fi

  # –ß—Ç–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ —Ñ–∞–π–ª–∞
  echo "‚è≥ –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: $file_path"
  adb shell "cat $file_path" | jq .
  echo "-------------------------------"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
if [ -z "$2" ]; then
  # –ó–∞–ø—Ä–æ—Å —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  echo "-------------------------------"
  echo "üìù –í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö"
  echo "\033[3m–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter‚Üµ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞\033[0m"

  # –ß—Ç–µ–Ω–∏–µ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  read user_input

  # –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –≤–≤–æ–¥ —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ –Ω—É–ª—è
  if [[ "$user_input" =~ ^[0-9]+$ ]] && [ "$user_input" -gt 0 ]; then
    interval=$user_input
  else
    # –ï—Å–ª–∏ –≤–≤–æ–¥ –ø—É—Å—Ç–æ–π, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ 0 –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è
    interval=0
  fi
else
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
  interval=$2
fi

# –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
update_count=0

# –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
clear
read_file

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –±–æ–ª—å—à–µ 0
while [ "$interval" -gt 0 ]; do
  sleep $interval
  read_file
done
