#!/bin/zsh

# ÐŸÐ¾Ð´ÑÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ utils.sh
source ./bashScript/utils.sh

# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ actualPath Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
actual_path=$(grep '^actualPath:' "settings.conf" | cut -d':' -f2 | xargs)

# ÐŸÑƒÑ‚ÑŒ Ðº Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð½Ð° ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ðµ Android
DIRECTORY="/sdcard/Android/data/farm.parking.game/files/profiles"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð»Ð¸ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ
if ! adb shell "[ -d $DIRECTORY ]"; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐŸÐ°Ð¿ÐºÐ° $DIRECTORY Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
    exit 1
fi

# ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ adb
files=$(adb shell "ls -1 $DIRECTORY | grep '.json$'")

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ ÐµÑÑ‚ÑŒ .json Ñ„Ð°Ð¹Ð»Ñ‹
if [[ -z "$files" ]]; then
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð’ Ð¿Ð°Ð¿ÐºÐµ $DIRECTORY Ð½ÐµÑ‚ .json Ñ„Ð°Ð¹Ð»Ð¾Ð²"
    exit 1
fi

# ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Ð¼Ð°ÑÑÐ¸Ð²
files_array=(${(f)files})

# Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ°
counter=1

# Ð’Ñ‹Ð²Ð¾Ð´ Ñ‚ÐµÐºÑÑ‚Ð° Ð¿ÐµÑ€ÐµÐ´ Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ð¸ÐµÐ¼ Ñ„Ð°Ð¹Ð»Ð¾Ð²
bold_text "$(reverse_text "Ð’Ñ‹Ð±Ð¸Ñ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ñ„Ð°Ð¹Ð» Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° Ð½Ð¸Ð¶Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ")"

# Ð’Ñ‹Ð²Ð¾Ð´ ÑÐ¿Ð¸ÑÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ñ Ð½ÑƒÐ¼ÐµÑ€Ð°Ñ†Ð¸ÐµÐ¹
for file in $files_array; do
    echo "    [$counter] $file"
    counter=$((counter + 1))
done

  # ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð²Ð²Ð¾Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  echo -n "ðŸ“ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ñ„Ð°Ð¹Ð»Ð° Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° Ð²Ñ‹ÑˆÐµ: "
  read profile_number

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ð²Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ñ‡Ð¸ÑÐ»Ð¾Ð¼ Ð¸ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¾Ð¼ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½Ðµ
if [[ "$profile_number" =~ '^[0-9]+$' ]] && (( profile_number >= 1 && profile_number <= ${#files_array[@]} )); then
    # ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¸Ð¼ÐµÐ½Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
    selected_file=${files_array[profile_number]}
    
    # Ð—Ð°Ð¿ÑƒÑÐº ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° readProfile.sh Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð¼ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
    echo $selected_file
    ./bashScript/readProfile.sh "$selected_file"
else
    echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð’Ð²ÐµÐ´ÐµÐ½ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð½Ð¾Ð¼ÐµÑ€ Ð¿Ñ€Ð¾Ñ„Ð°Ð¹Ð»Ð°"
    exit 1
fi
